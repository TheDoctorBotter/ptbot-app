# Supabase Edge Functions Configuration
# https://supabase.com/docs/guides/functions/config

# =============================================================================
# EDGE FUNCTION SETTINGS
# =============================================================================
# verify_jwt = true (default): Gateway validates JWT before forwarding request.
#   Invalid/expired tokens return 401 before the function runs.
# verify_jwt = false: Gateway forwards request without JWT validation.
#   The function handles auth internally (required for anonymous access).

# calendar-availability: Public endpoint - anyone can view available slots
[functions.calendar-availability]
verify_jwt = false

# calendar-book: Public endpoint - supports booking with or without an account
[functions.calendar-book]
verify_jwt = false

# calendar-appointments: Requires auth - users must be logged in to view/manage
[functions.calendar-appointments]
verify_jwt = true

# openai-proxy: Requires auth - only authenticated users can use the AI chat
[functions.openai-proxy]
verify_jwt = true

# stripe-checkout: verify_jwt = false so the Supabase gateway does NOT add a
# second JWT check before the function runs.  The function already validates
# the JWT internally via supabase.auth.getUser(), so gateway-level verification
# is redundant.  Having verify_jwt = true can also produce a 401 at the gateway
# when the JWT belongs to a project configuration the gateway doesn't recognise,
# making the error hard to debug.
[functions.stripe-checkout]
verify_jwt = false

# stripe-webhook: Public endpoint - Stripe sends webhooks without JWT
[functions.stripe-webhook]
verify_jwt = false

# get-plan-exercises: Requires auth - enforces exercise access limits server-side
[functions.get-plan-exercises]
verify_jwt = true

# consume-telehealth-credit: Requires auth - atomically deducts a consult credit
[functions.consume-telehealth-credit]
verify_jwt = true
